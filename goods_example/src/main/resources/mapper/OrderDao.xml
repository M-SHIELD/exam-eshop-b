<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.micah.goods_example.dao.OrderDao">

    <resultMap id="BaseResultMap" type="com.micah.goods_example.entity.Order">
        <!--@Table 商品订单-->
        <result property="ddid" column="订单ID" jdbcType="INTEGER"/>
        <result property="pid" column="pid" jdbcType="INTEGER"/>
        <result property="时间" column="时间" jdbcType="TIMESTAMP"/>
        <result property="maijiaid" column="MaiJiaID" jdbcType="INTEGER"/>
        <result property="number" column="number" jdbcType="INTEGER"/>
        <result property="地址id" column="地址ID" jdbcType="INTEGER"/>
        <result property="state" column="state" jdbcType="INTEGER"/>
        <result property="isEnd" column="isEnd" jdbcType="INTEGER"/>
    </resultMap>

    <!--查询单个-->
    <select id="queryById" resultMap="BaseResultMap">
        select
          订单ID, pid, 时间, MaiJiaID, number, 地址ID
        from example_goods.商品订单
        where 订单ID = #{订单id}
    </select>

    <!--查询指定行数据-->
    <select id="queryAllByLimit" resultMap="BaseResultMap">
        select
          订单ID, pid, 时间, MaiJiaID, number, 地址ID
        from example_goods.商品订单
        limit #{offset}, #{limit}
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="queryAll" resultMap="BaseResultMap">
        select
          订单ID, pid, 时间, MaiJiaID, number, 地址ID
        from example_goods.商品订单
        <where>
            <if test="订单id != null">
                and 订单ID = #{订单id}
            </if>
            <if test="pid != null">
                and pid = #{pid}
            </if>
            <if test="时间 != null">
                and 时间 = #{时间}
            </if>
            <if test="maijiaid != null">
                and MaiJiaID = #{maijiaid}
            </if>
            <if test="number != null">
                and number = #{number}
            </if>
            <if test="地址id != null">
                and 地址ID = #{地址id}
            </if>
        </where>
    </select>
<!--通过实体作为筛选条件查询-->
    <select id="queryOne" resultMap="BaseResultMap">
        select
          订单ID, pid, 时间, MaiJiaID, number, 地址ID
        from example_goods.商品订单
        <where>
            <if test="订单id != null">
                and 订单ID = #{订单id}
            </if>
            <if test="pid != null">
                and pid = #{pid}
            </if>
            <if test="时间 != null">
                and 时间 = #{时间}
            </if>
            <if test="maijiaid != null">
                and MaiJiaID = #{maijiaid}
            </if>
            <if test="number != null">
                and number = #{number}
            </if>
            <if test="地址id != null">
                and 地址ID = #{地址id}
            </if>
        </where>
        limit 0,1
    </select>
    <select id="getGoodsOrderByMaiJiaId" resultType="com.micah.goods_example.entity.OrderDTO" parameterType="map">
        SELECT
            s.`订单ID`,
            g.pname,
            sku.price,
            s.`时间`,
            m.MaiJiaName,
            a.`地址`,
            s.number,
            s.state,
            s.isEnd
        FROM
            商品订单 s,
            goods g,
            maijia m,
            address a,
            sku
        WHERE
            g.pid = s.pid
        AND m.MaiJiaID = s.MaiJiaID
        AND s.`地址ID` = a.`地址ID`
        AND sku.id = 1
        AND s.MaiJiaID = #{maijiaid}
        <if test="state != null">
            AND s.state = #{state}
        </if>
        <if test="订单id != null">
            AND s.订单id = #{订单id}
        </if>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="订单id" useGeneratedKeys="true">
        insert into example_goods.商品订单(pid, 时间, MaiJiaID, number, 地址ID)
        values (#{pid}, #{时间}, #{maijiaid}, #{number}, #{地址id})
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update example_goods.商品订单
        <set>
            <if test="pid != null">
                pid = #{pid},
            </if>
            <if test="时间 != null">
                时间 = #{时间},
            </if>
            <if test="maijiaid != null">
                MaiJiaID = #{maijiaid},
            </if>
            <if test="number != null">
                number = #{number},
            </if>
            <if test="地址id != null">
                地址ID = #{地址id},
            </if>
        </set>
        where 订单ID = #{订单id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete from example_goods.商品订单 where 订单ID = #{订单id}
    </delete>



</mapper>
